<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Bet Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* =========================================
           1. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò
           ========================================= */
        :root {
            /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ Premium Dark */
            --bg-body: #0b0e11;       /* –ì–ª—É–±–æ–∫–∏–π —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
            --bg-card: #151a21;       /* –§–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
            --bg-header: rgba(11, 14, 17, 0.85); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —à–∞–ø–∫–∞ */
            
            --accent-green: #00b359;  /* –û—Å–Ω–æ–≤–Ω–æ–π –∑–µ–ª–µ–Ω—ã–π (Win/Action) */
            --accent-green-dim: rgba(0, 179, 89, 0.15);
            
            --accent-gold: #ffc107;   /* –ó–æ–ª–æ—Ç–æ–π (Premium/Stars) */
            --accent-red: #ff4d4d;    /* –ö—Ä–∞—Å–Ω—ã–π (Live/Loss) */
            --accent-blue: #2d8cf0;   /* –°–∏–Ω–∏–π (Info/Dice) */
            
            --text-primary: #ffffff;
            --text-secondary: #8b95a5;
            
            --border-color: #2a303c;
            --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.4);
            
            --font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-family);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä (—Å–∫—Ä—ã–≤–∞–µ–º –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã) */
        ::-webkit-scrollbar { display: none; }

        /* =========================================
           2. –®–ê–ü–ö–ê –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø
           ========================================= */
        header {
            height: 60px;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-header);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .logo {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(45deg, #fff, #8b95a5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .logo span { color: var(--accent-green); -webkit-text-fill-color: initial; }

        .balance-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            padding: 6px 14px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .balance-val { font-weight: 700; font-size: 15px; letter-spacing: 0.5px; }
        .btn-plus {
            width: 24px; height: 24px;
            background: var(--accent-blue);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: white; border: none; cursor: pointer;
        }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        nav {
            height: 80px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 20px; /* –£—á–µ—Ç safe area iPhone */
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-secondary);
            font-size: 10px;
            width: 20%;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .nav-item i { font-size: 20px; margin-bottom: 2px; }
        .nav-item.active { color: var(--text-primary); }
        .nav-item.active i { color: var(--accent-green); transform: translateY(-3px); }

        /* =========================================
           3. –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢
           ========================================= */
        main {
            flex: 1;
            margin-top: 60px; /* –û—Ç—Å—Ç—É–ø –æ—Ç —à–∞–ø–∫–∏ */
            padding: 16px;
            padding-bottom: 100px; /* –û—Ç—Å—Ç—É–ø –æ—Ç –º–µ–Ω—é */
            overflow-y: auto;
        }

        .page { display: none; animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä (–ú–µ–Ω—é) */
        .games-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .game-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            height: 120px;
            padding: 16px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .game-card:active { transform: scale(0.98); opacity: 0.9; }
        .game-card.featured { grid-column: span 2; background: linear-gradient(135deg, var(--bg-card), #1c2530); }
        .game-card h3 { margin: 0; font-size: 16px; z-index: 2; }
        .game-card p { margin: 4px 0 0; font-size: 11px; color: var(--text-secondary); z-index: 2; }
        .game-icon {
            position: absolute; top: 10px; right: 10px;
            font-size: 60px; color: rgba(255,255,255,0.03);
            transform: rotate(-15deg);
        }

        /* =========================================
           4. –°–ü–û–†–¢ (–ö–ê–†–¢–û–ß–ö–ò)
           ========================================= */
        .sport-tabs {
            display: flex; gap: 8px; overflow-x: auto; 
            padding-bottom: 10px; margin-bottom: 10px;
            scrollbar-width: none; /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        }
        .sport-tab {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            transition: 0.2s;
        }
        .sport-tab.active {
            background: var(--text-primary);
            color: var(--bg-body);
            font-weight: 700;
            border-color: var(--text-primary);
        }

        .match-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        .match-header {
            display: flex; justify-content: space-between;
            font-size: 11px; color: var(--text-secondary);
            margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        .live-tag {
            color: var(--accent-red); font-weight: 800;
            display: flex; align-items: center; gap: 5px;
        }
        .live-dot {
            width: 6px; height: 6px;
            background: var(--accent-red);
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 0% {opacity:1} 50% {opacity:0.4} 100% {opacity:1} }

        .time-tag { color: var(--text-primary); font-weight: 600; display: flex; align-items: center; gap: 5px; }

        .teams-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 16px;
        }
        .team-name { font-size: 14px; font-weight: 600; width: 40%; line-height: 1.2; }
        .score-display {
            font-size: 20px; font-weight: 800; color: var(--text-primary);
            background: rgba(255,255,255,0.05);
            padding: 4px 10px; border-radius: 8px;
            letter-spacing: 2px;
        }

        .coeffs-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .coeff-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            transition: 0.2s;
        }
        .coeff-btn:active { background: rgba(255,255,255,0.1); transform: scale(0.98); }
        .coeff-title { display: block; font-size: 10px; color: var(--text-secondary); margin-bottom: 2px; }
        .coeff-val { display: block; font-size: 14px; font-weight: 700; color: var(--accent-green); }

        /* =========================================
           5. MINES & DICE
           ========================================= */
        .game-controls {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        input[type="number"], input[type="range"] {
            width: 100%;
            background: #090b0e;
            border: 1px solid var(--border-color);
            padding: 14px;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            outline: none;
        }
        input:focus { border-color: var(--accent-green); }

        .action-btn {
            width: 100%; padding: 16px;
            border-radius: 12px; border: none;
            background: var(--accent-green);
            color: white; font-weight: 700; font-size: 16px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px var(--accent-green-dim);
            cursor: pointer; transition: 0.1s;
        }
        .action-btn:active { transform: scale(0.98); }
        .action-btn.cashout { background: var(--accent-gold); color: #000; }

        /* Mines Grid */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; max-width: 350px; margin: 0 auto; }
        .mine-cell {
            aspect-ratio: 1; background: var(--bg-card);
            border: 1px solid var(--border-color); border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; transition: 0.2s;
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.3);
        }
        .mine-cell:active { transform: translateY(2px); box-shadow: none; }
        .mine-cell.revealed { background: #222; box-shadow: none; cursor: default; }
        .mine-cell.gem { background: rgba(0, 179, 89, 0.2); border-color: var(--accent-green); }
        .mine-cell.boom { background: rgba(255, 77, 77, 0.2); border-color: var(--accent-red); }

        /* Dice 3D */
        .dice-container { height: 200px; display: flex; align-items: center; justify-content: center; perspective: 1000px; }
        .cube { width: 80px; height: 80px; position: relative; transform-style: preserve-3d; transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1.2); }
        .face {
            position: absolute; width: 80px; height: 80px;
            background: linear-gradient(145deg, #1a222d, #111);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; font-weight: bold; color: white;
            box-shadow: 0 0 15px rgba(45, 140, 240, 0.3);
        }
        .f1 { transform: translateZ(40px); }
        .f2 { transform: rotateY(180deg) translateZ(40px); }
        .f3 { transform: rotateY(90deg) translateZ(40px); }
        .f4 { transform: rotateY(-90deg) translateZ(40px); }
        .f5 { transform: rotateX(90deg) translateZ(40px); }
        .f6 { transform: rotateX(-90deg) translateZ(40px); }

        /* =========================================
           6. –ê–î–ú–ò–ù–ö–ê –ò –ü–†–û–§–ò–õ–¨
           ========================================= */
        .admin-panel {
            margin-top: 20px; padding: 20px;
            border: 1px solid var(--accent-red);
            border-radius: 12px; background: rgba(255, 77, 77, 0.05);
            display: none;
        }
        .profile-stat { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid var(--border-color); }
        .stat-val { font-weight: bold; color: var(--text-primary); }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
        .toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); color: white; padding: 10px 20px;
            border-radius: 20px; font-size: 12px; z-index: 2000;
            display: none; animation: slideUp 0.3s;
        }
        @keyframes slideUp { from{transform:translate(-50%, 20px);opacity:0} to{transform:translate(-50%,0);opacity:1} }

    </style>
</head>
<body>

    <!-- === HEADER === -->
    <header>
        <div class="logo">ROYAL<span>BET</span></div>
        <div class="balance-container">
            <span style="color:var(--accent-green)">‚ÇΩ</span>
            <span id="ui-balance" class="balance-val">...</span>
            <button class="btn-plus" onclick="App.deposit()">+</button>
        </div>
    </header>

    <!-- === MAIN PAGES === -->
    <main>
        
        <!-- 1. –ì–õ–ê–í–ù–ê–Ø (LOBBY) -->
        <section id="p-menu" class="page active">
            <h2 style="margin-top:0">–ò–≥—Ä—ã</h2>
            <div class="games-grid">
                <div class="game-card featured" onclick="App.nav('sport')">
                    <i class="fas fa-trophy game-icon"></i>
                    <h3>–°–ø–æ—Ä—Ç Live</h3>
                    <p>–õ—É—á—à–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã</p>
                </div>
                <div class="game-card" onclick="App.nav('mines')">
                    <i class="fas fa-bomb game-icon"></i>
                    <h3>Mines</h3>
                    <p>–°–∞–ø–µ—Ä</p>
                </div>
                <div class="game-card" onclick="App.nav('dice')">
                    <i class="fas fa-dice game-icon"></i>
                    <h3>Dice</h3>
                    <p>–ö—É–±–∏–∫</p>
                </div>
            </div>
        </section>

        <!-- 2. –°–ü–û–†–¢ -->
        <section id="p-sport" class="page">
            <h2 style="margin-top:0">–õ–∏–Ω–∏—è</h2>
            
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="sport-tabs">
                <div class="sport-tab active" onclick="Sport.filter('football', this)">‚öΩ –§—É—Ç–±–æ–ª</div>
                <div class="sport-tab" onclick="Sport.filter('hockey', this)">üèí –•–æ–∫–∫–µ–π</div>
                <div class="sport-tab" onclick="Sport.filter('tennis', this)">üéæ –¢–µ–Ω–Ω–∏—Å</div>
                <div class="sport-tab" onclick="Sport.filter('basketball', this)">üèÄ –ë–∞—Å–∫–µ—Ç</div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –º–∞—Ç—á–µ–π -->
            <div id="sport-feed">
                <!-- –°—é–¥–∞ JS –≤—Å—Ç–∞–≤–∏—Ç –º–∞—Ç—á–∏ -->
                <div style="text-align:center; padding:20px; color:#555;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
            </div>
        </section>

        <!-- 3. MINES -->
        <section id="p-mines" class="page">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                <i class="fas fa-chevron-left" onclick="App.nav('menu')" style="padding:10px;"></i>
                <h2>Mines</h2>
            </div>
            
            <div class="game-controls">
                <div style="display:flex; justify-content:space-between; font-size:12px; color:#888; margin-bottom:5px;">
                    <span>–°—Ç–∞–≤–∫–∞</span> <span>–ë–∞–ª–∞–Ω—Å: <span id="m-bal">0</span></span>
                </div>
                <input type="number" id="m-bet" value="100" placeholder="–°—É–º–º–∞">
                
                <div style="display:flex; justify-content:space-between; font-size:12px; color:#888; margin-bottom:5px;">
                    <span>–ö–æ–ª-–≤–æ –º–∏–Ω: <b id="m-cnt-val" style="color:white">3</b></span>
                    <span id="m-next-k" style="color:var(--accent-green)"></span>
                </div>
                <input type="range" id="m-cnt" min="3" max="24" value="3" oninput="Mines.updInput()">
                
                <button id="m-btn" class="action-btn" onclick="Mines.start()">–ò–ì–†–ê–¢–¨</button>
                <button id="m-cash" class="action-btn cashout" style="display:none;" onclick="Mines.cashout()">–ó–ê–ë–†–ê–¢–¨</button>
            </div>

            <div class="mines-grid" id="m-grid"></div>
        </section>

        <!-- 4. DICE -->
        <section id="p-dice" class="page">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                <i class="fas fa-chevron-left" onclick="App.nav('menu')" style="padding:10px;"></i>
                <h2>Dice 3D</h2>
            </div>

            <div class="dice-stage">
                <div class="cube" id="d-cube">
                    <div class="face f1">1</div><div class="face f2">6</div>
                    <div class="face f3">2</div><div class="face f4">5</div>
                    <div class="face f5">3</div><div class="face f6">4</div>
                </div>
            </div>

            <div class="game-controls">
                <input type="number" id="d-bet" value="100">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
                    <button class="coeff-btn" id="d-even" onclick="Dice.type('even')">–ß–ï–¢ <br><b>x1.90</b></button>
                    <button class="coeff-btn" id="d-odd" onclick="Dice.type('odd')">–ù–ï–ß–ï–¢ <br><b>x1.90</b></button>
                </div>
                <button class="action-btn" style="background:var(--accent-blue)" onclick="Dice.roll()">–ë–†–û–°–û–ö</button>
            </div>
        </section>

        <!-- 5. –ü–†–û–§–ò–õ–¨ -->
        <section id="p-profile" class="page">
            <h2 style="margin-top:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            
            <div class="game-controls" style="text-align:center;">
                <div style="width:70px; height:70px; background:#21262d; border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:30px; border:2px solid var(--border-color);">üòé</div>
                <h3>ID: <span id="prof-id">...</span></h3>
                <div style="margin-top:10px; opacity:0.3; font-size:10px;" onclick="App.toggleAdmin()">v2.0 (Tap 5x for Admin)</div>
            </div>

            <!-- –†–µ—Ñ–µ—Ä–∞–ª–∫–∞ -->
            <div style="background:linear-gradient(135deg, #1c2530, #111); border:1px solid var(--accent-gold); border-radius:16px; padding:15px; margin-top:15px;">
                <h3 style="color:var(--accent-gold); margin:0;">ü§ù –ü–∞—Ä—Ç–Ω–µ—Ä–∫–∞</h3>
                <p style="font-size:12px; color:#888;">–ü–æ–ª—É—á–∞–π <b>10%</b> –æ—Ç –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –¥—Ä—É–∑–µ–π!</p>
                <div style="display:flex; justify-content:space-around; margin:15px 0; font-size:14px;">
                    <div>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ: <b id="ui-ref-count" style="color:white">0</b></div>
                    <div>–î–æ—Ö–æ–¥: <b id="ui-ref-earn" style="color:var(--accent-green)">0 ‚ÇΩ</b></div>
                </div>
                <button class="action-btn" style="padding:10px; font-size:12px;" onclick="App.shareRef()">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</button>
            </div>

            <!-- –ê–¥–º–∏–Ω–∫–∞ (—Å–∫—Ä—ã—Ç–∞) -->
            <div id="admin-panel" class="admin-panel">
                <h4 style="color:var(--accent-red); margin-top:0;">ADMIN ZONE</h4>
                <input type="number" id="adm-amount" placeholder="–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å">
                <button class="action-btn" onclick="App.adminSetBalance()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <h3 style="margin-top:20px;">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫</h3>
            <div id="history-list" style="font-size:12px; color:#888;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </section>

    </main>

    <!-- === TOAST === -->
    <div id="toast" class="toast">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>

    <!-- === NAV === -->
    <nav>
        <div class="nav-item active" onclick="App.nav('menu')"><i class="fas fa-home"></i>–ì–ª–∞–≤–Ω–∞—è</div>
        <div class="nav-item" onclick="App.nav('sport')"><i class="fas fa-futbol"></i>–°–ø–æ—Ä—Ç</div>
        <div class="nav-item" onclick="App.nav('profile')"><i class="fas fa-user"></i>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;

        // !!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –°–°–´–õ–ö–£ RENDER (–ë–ï–ó –°–õ–ï–®–ê –í –ö–û–ù–¶–ï) !!!
        const API_URL = "https://backend-4jag.onrender.com"; 

        const App = {
            userId: 0,
            bal: 0,
            adminTaps: 0,
            
            init: async function() {
                tg.ready(); tg.expand();
                const u = tg.initDataUnsafe?.user;
                this.userId = u ? u.id : 12345; // Test ID
                document.getElementById('prof-id').innerText = this.userId;
                
                const startParam = tg.initDataUnsafe?.start_param;
                await this.fetchData(startParam);
                
                Sport.init();
                Mines.init();
            },

            fetchData: async function(refId) {
                try {
                    let url = `${API_URL}/api/user/${this.userId}`;
                    if(refId) url += `?ref_id=${refId}`;
                    
                    let res = await fetch(url);
                    let data = await res.json();
                    
                    this.bal = data.balance;
                    document.getElementById('ui-ref-count').innerText = data.ref_count;
                    document.getElementById('ui-ref-earn').innerText = Math.floor(data.ref_earn) + ' ‚ÇΩ';
                    this.updateUI(data.history);
                } catch(e) { console.log('Offline'); }
            },

            sendBet: async function(game, bet, win, coeff) {
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (—á—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä)
                this.bal = this.bal - bet + win;
                this.updateUI();

                try {
                    let res = await fetch(`${API_URL}/api/bet`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ user_id: this.userId, game, bet, win, coeff })
                    });
                    let data = await res.json();
                    if(data.status === 'ok') {
                        this.bal = data.new_balance; // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
                        this.fetchData(); // –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                    }
                } catch(e) { this.toast("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
            },

            adminSetBalance: async function() {
                let amount = document.getElementById('adm-amount').value;
                await fetch(`${API_URL}/api/admin/set`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: this.userId, amount: amount })
                });
                this.bal = parseFloat(amount);
                this.updateUI();
                this.toast("–ë–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–µ–Ω");
            },

            updateUI: function(hist) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤–µ–∑–¥–µ
                const val = Math.floor(this.bal).toLocaleString();
                document.getElementById('ui-balance').innerText = val;
                if(document.getElementById('m-bal')) document.getElementById('m-bal').innerText = val;

                if(hist) {
                    const list = document.getElementById('history-list');
                    if(hist.length === 0) list.innerHTML = "<center>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</center>";
                    else {
                        list.innerHTML = hist.slice(0, 10).map(h => `
                            <div style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #2a303c;">
                                <div>
                                    <div style="font-weight:bold; font-size:13px;">${h.game}</div>
                                    <div style="font-size:11px; color:#888;">–°—Ç–∞–≤–∫–∞: ${h.bet}‚ÇΩ ‚Ä¢ –ö—ç—Ñ: x${h.coeff}</div>
                                </div>
                                <div style="text-align:right; font-weight:bold; color:${(h.w - h.bet) > 0 ? '#00b359' : '#ff4d4d'}">
                                    ${(h.w - h.bet) > 0 ? '+' : ''}${Math.floor(h.w - h.bet)} ‚ÇΩ
                                </div>
                            </div>
                        `).join('');
                    }
                }
            },

            nav: function(p) {
                document.querySelectorAll('.page').forEach(e => e.classList.remove('active'));
                document.getElementById('p-'+p).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
                if(p==='menu'||p==='mines'||p==='dice') document.querySelectorAll('.nav-item')[0].classList.add('active');
                if(p==='sport') document.querySelectorAll('.nav-item')[1].classList.add('active');
                if(p==='profile') document.querySelectorAll('.nav-item')[2].classList.add('active');
            },

            toggleAdmin: function() {
                this.adminTaps++;
                if(this.adminTaps === 5) {
                    document.getElementById('admin-panel').style.display = 'block';
                    this.toast("Admin Mode ON");
                }
            },

            shareRef: function() {
                tg.openTelegramLink(`https://t.me/share/url?url=https://t.me/YOUR_BOT?start=${this.userId}&text=–ò–≥—Ä–∞–π+—Å–æ+–º–Ω–æ–π!`);
            },
            
            deposit: function() { tg.showAlert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.'); },
            
            toast: function(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg; t.style.display = 'block';
                setTimeout(()=> t.style.display='none', 2000);
            }
        };

        // --- –°–ü–û–†–¢ ---
        const Sport = {
            matches: [], curCat: 'football',
            init: function() {
                this.load();
                setInterval(() => this.load(), 3000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫
            },
            load: async function() {
                try {
                    let res = await fetch(`${API_URL}/api/matches`);
                    this.matches = await res.json();
                    if(document.getElementById('p-sport').classList.contains('active')) this.render();
                } catch(e) {}
            },
            filter: function(cat, btn) {
                this.curCat = cat;
                document.querySelectorAll('.sport-tab').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.render();
            },
            render: function() {
                const list = this.matches.filter(m => m.cat === this.curCat).sort((a,b) => {
                    if (a.isLive !== b.isLive) return a.isLive ? -1 : 1;
                    return a.timestamp - b.timestamp;
                });

                document.getElementById('sport-feed').innerHTML = list.map(m => {
                    const date = new Date(m.timestamp);
                    // –ö—Ä–∞—Å–∏–≤–æ–µ –≤—Ä–µ–º—è
                    let timeDisplay = "";
                    if (m.isLive) {
                        // –ï—Å–ª–∏ —Ç–µ–Ω–Ω–∏—Å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ç—ã
                        if(m.cat === 'tennis') timeDisplay = `–°–µ—Ç ${m.sets.length}`;
                        else timeDisplay = `${Math.floor(m.time)}' –º–∏–Ω`;
                    } else {
                        // –ï—Å–ª–∏ –±—É–¥—É—â–µ–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º—è
                        const hours = date.getHours().toString().padStart(2, '0');
                        const mins = date.getMinutes().toString().padStart(2, '0');
                        timeDisplay = `–ù–∞—á–∞–ª–æ –≤ ${hours}:${mins}`;
                    }

                    // –ë–µ–π–¥–∂ Live
                    const badge = m.isLive ? 
                        `<div class="live-tag"><div class="live-dot"></div> LIVE</div>` : 
                        `<div class="time-tag"><i class="far fa-clock"></i> ${timeDisplay}</div>`;

                    return `
                    <div class="match-card">
                        <div class="match-header">
                            ${badge}
                            <span style="opacity:0.6">${m.cat.toUpperCase()}</span>
                        </div>
                        <div class="teams-row">
                            <div class="team-name">${m.t1}</div>
                            <div class="score-display">${m.s1} : ${m.s2}</div>
                            <div class="team-name" style="text-align:right">${m.t2}</div>
                        </div>
                        <div class="coeffs-row">
                            <div class="coeff-btn" onclick="Sport.bet(100, 1.85)"><span class="coeff-title">–ü1</span><span class="coeff-val">1.85</span></div>
                            <div class="coeff-btn" onclick="Sport.bet(100, 3.40)"><span class="coeff-title">X</span><span class="coeff-val">3.40</span></div>
                            <div class="coeff-btn" onclick="Sport.bet(100, 2.10)"><span class="coeff-title">–ü2</span><span class="coeff-val">2.10</span></div>
                        </div>
                    </div>`;
                }).join('');
            },
            bet: function(amt, k) {
                if(App.bal < amt) return App.toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
                // –ü–æ–∫–∞ —Ä–∞–Ω–¥–æ–º–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à –¥–ª—è —Ç–µ—Å—Ç–∞, –≤ –∏–¥–µ–∞–ª–µ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —Ä–µ—à–∞—Ç—å
                // –ù–æ –¥–ª—è —Å–ø–æ—Ä—Ç–∞ —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫: –°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Win/Lose) –ø—Ä–∏–ª–µ—Ç–∏—Ç –ø–æ–∑–∂–µ
                // –í –¥–∞–Ω–Ω–æ–π –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É –∏ –≥–æ–≤–æ—Ä–∏–º "–ü—Ä–∏–Ω—è—Ç–æ"
                App.sendBet('Sport', amt, 0, k); // 0 –≤—ã–∏–≥—Ä—ã—à (–ø–æ–∫–∞ –º–∞—Ç—á –∏–¥–µ—Ç)
                App.toast(`–°—Ç–∞–≤–∫–∞ ${amt}‚ÇΩ –ø—Ä–∏–Ω—è—Ç–∞!`);
            }
        };

        // --- MINES ---
        const Mines = {
            act: false, grid: [], bet: 0, mines: 3, step: 0,
            init: function() {
                const g = document.getElementById('m-grid'); g.innerHTML = '';
                for(let i=0; i<25; i++) {
                    let d = document.createElement('div');
                    d.className = 'mine-cell';
                    d.onclick = () => this.click(i, d);
                    g.appendChild(d);
                }
            },
            updInput: function() { 
                this.mines = +document.getElementById('m-cnt').value;
                document.getElementById('m-cnt-val').innerText = this.mines;
            },
            start: function() {
                let bet = +document.getElementById('m-bet').value;
                if(bet > App.bal) return App.toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
                
                // –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ
                document.getElementById('ui-balance').innerText = (App.bal - bet).toFixed(0);
                
                this.bet = bet; this.act = true; this.step = 0;
                this.grid = Array(25).fill(0);
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω (–Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç)
                let c = 0; while(c < this.mines) { let r=Math.floor(Math.random()*25); if(this.grid[r]===0){this.grid[r]=1; c++} }
                
                document.getElementById('m-btn').style.display = 'none';
                document.getElementById('m-cash').style.display = 'block';
                document.getElementById('m-cash').innerText = "–ó–ê–ë–†–ê–¢–¨";
                
                document.querySelectorAll('.mine-cell').forEach(c => {
                    c.className = 'mine-cell'; c.innerText = '';
                });
            },
            click: function(i, el) {
                if(!this.act || el.classList.contains('revealed')) return;
                el.classList.add('revealed');
                
                if(this.grid[i] === 1) {
                    el.classList.add('boom'); el.innerText = 'üí£';
                    this.end(false);
                } else {
                    el.classList.add('gem'); el.innerText = 'üíé';
                    this.step++;
                    // –ü—Ä–æ—Å—Ç–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∫—ç—Ñ–∞
                    let multiplier = 1;
                    for(let k=0; k<this.step; k++) multiplier *= (25-k) / (25-this.mines-k);
                    
                    this.currWin = Math.floor(this.bet * multiplier * 0.95);
                    document.getElementById('m-cash').innerText = `–ó–ê–ë–†–ê–¢–¨ ${this.currWin} ‚ÇΩ`;
                }
            },
            cashout: function() { this.end(true); },
            end: function(win) {
                this.act = false;
                document.getElementById('m-btn').style.display = 'block';
                document.getElementById('m-cash').style.display = 'none';
                
                let winAmount = win ? this.currWin : 0;
                let coeff = win ? (winAmount / this.bet).toFixed(2) : 0;
                
                App.sendBet('Mines', this.bet, winAmount, coeff);
                
                if(!win) {
                    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∏–Ω—ã
                    this.grid.forEach((v, k) => {
                        if(v===1) {
                            let c = document.getElementById('m-grid').children[k];
                            c.classList.add('revealed', 'boom'); c.innerText = 'üí£';
                        }
                    });
                }
            }
        };

        // --- DICE ---
        const Dice = {
            sel: null,
            type: function(t) {
                this.sel = t;
                document.getElementById('d-even').style.borderColor = (t==='even' ? '#00b359' : '#2a303c');
                document.getElementById('d-odd').style.borderColor = (t==='odd' ? '#00b359' : '#2a303c');
            },
            roll: function() {
                let bet = +document.getElementById('d-bet').value;
                if(!this.sel) return App.toast("–í—ã–±–µ—Ä–∏—Ç–µ –ß–µ—Ç –∏–ª–∏ –ù–µ—á–µ—Ç");
                if(bet > App.bal) return App.toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
                
                // –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ
                document.getElementById('ui-balance').innerText = (App.bal - bet).toFixed(0);
                
                let r = Math.floor(Math.random()*6)+1;
                let x=0, y=0;
                // –í—Ä–∞—â–µ–Ω–∏–µ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ)
                if(r===1) {x=0;y=0;} if(r===6) {x=180;y=0;}
                if(r===2) {x=-90;y=0;} if(r===5) {x=90;y=0;}
                if(r===3) {x=0;y=90;} if(r===4) {x=0;y=-90;}
                
                document.getElementById('d-cube').style.transform = `rotateX(${x + 720}deg) rotateY(${y + 720}deg)`;
                
                setTimeout(() => {
                    let win = (this.sel==='even' && r%2===0) || (this.sel==='odd' && r%2!==0);
                    let winAmt = win ? Math.floor(bet * 1.9) : 0;
                    
                    App.sendBet('Dice', bet, winAmt, 1.9);
                    App.toast(win ? `–ü–æ–±–µ–¥–∞! +${winAmt}‚ÇΩ` : `–í—ã–ø–∞–ª–æ ${r}. –ü–æ—Ä–∞–∂–µ–Ω–∏–µ`);
                }, 1600);
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
