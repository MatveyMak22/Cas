<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RoyalBet Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* =========================================
           1. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
           ========================================= */
        :root {
            --bg-body: #0b0e11;       /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω */
            --bg-card: #151a21;       /* –§–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
            --bg-header: rgba(11, 14, 17, 0.95);
            
            --accent: #ff6600;        /* –û—Ä–∞–Ω–∂–µ–≤—ã–π –∞–∫—Ü–µ–Ω—Ç (Winline —Å—Ç–∏–ª—å) */
            --accent-green: #28a745;  /* –ü–æ–±–µ–¥–∞ */
            --accent-red: #dc3545;    /* Live / –ü—Ä–æ–∏–≥—Ä—ã—à */
            --accent-blue: #007bff;   /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
            
            --text-main: #ffffff;
            --text-sub: #8b95a5;
            --border: #2a303c;
            
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
        ::-webkit-scrollbar { display: none; }

        /* =========================================
           2. –®–ê–ü–ö–ê (HEADER)
           ========================================= */
        header {
            height: 60px;
            padding: 0 16px;
            background: var(--bg-header);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
        }

        .logo {
            font-size: 20px;
            font-weight: 900;
            font-style: italic;
            letter-spacing: -1px;
            color: white;
        }
        .logo span { color: var(--accent); }

        .balance-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* =========================================
           3. –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ –ò –°–¢–†–ê–ù–ò–¶–´
           ========================================= */
        main {
            flex: 1;
            margin-top: 60px;
            padding: 16px;
            padding-bottom: 90px; /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é */
            overflow-y: auto;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* =========================================
           4. –ö–ê–†–¢–û–ß–ö–ò –ú–ê–¢–ß–ï–ô (SPORT)
           ========================================= */
        /* –§–∏–ª—å—Ç—Ä—ã –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞ */
        .sport-cats {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 10px;
            scrollbar-width: none;
        }
        .cat-chip {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-sub);
            white-space: nowrap;
            transition: 0.2s;
            cursor: pointer;
        }
        .cat-chip.active {
            background: var(--text-main);
            color: var(--bg-body);
            font-weight: 800;
            border-color: var(--text-main);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –º–∞—Ç—á–∞ */
        .match-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-sub);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä LIVE */
        .live-tag {
            color: var(--accent-red);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--accent-red);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.4;} 100% {opacity: 1;} }

        /* –û–±—ã—á–Ω—ã–π –≤–∏–¥ (–§—É—Ç–±–æ–ª/–•–æ–∫–∫–µ–π) */
        .teams-classic {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .team-col {
            width: 40%;
            text-align: center;
        }
        .team-shirt {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .team-name {
            font-size: 13px;
            font-weight: 600;
            line-height: 1.2;
        }
        .score-big {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: 2px;
        }

        /* –¢–∞–±–ª–∏—á–Ω—ã–π –≤–∏–¥ (–¢–µ–Ω–Ω–∏—Å) */
        .table-tennis-grid {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-bottom: 15px;
        }
        .table-tennis-grid td {
            padding: 6px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .tt-name {
            text-align: left;
            font-weight: 600;
            width: 40%;
        }
        .tt-main-score {
            background: rgba(255,255,255,0.1);
            font-weight: 800;
            color: white;
            width: 30px;
        }
        .tt-set-score {
            color: var(--text-sub);
            font-size: 12px;
        }
        .tt-set-active {
            color: var(--accent);
            font-weight: bold;
        }

        /* –ö–Ω–æ–ø–∫–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ */
        .coeffs-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }
        .coeff-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
        }
        .coeff-btn:active { background: rgba(255,255,255,0.1); }
        .coeff-label { display: block; font-size: 10px; color: var(--text-sub); }
        .coeff-val { display: block; font-size: 14px; font-weight: 700; color: var(--text-main); margin-top: 2px; }

        /* =========================================
           5. –ú–û–ò –ü–ê–†–ò (HISTORY)
           ========================================= */
        .history-tabs {
            display: flex;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        .h-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--text-sub);
            transition: 0.2s;
            cursor: pointer;
        }
        .h-tab.active {
            background: var(--border);
            color: var(--text-main);
            font-weight: 700;
        }

        .bet-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--border);
            position: relative;
        }
        .bet-item.win { border-left-color: var(--accent-green); }
        .bet-item.lose { border-left-color: var(--accent-red); }
        .bet-item.active { border-left-color: var(--accent); }

        .bet-top { display: flex; justify-content: space-between; font-size: 13px; font-weight: 700; margin-bottom: 6px; }
        .bet-details { font-size: 11px; color: var(--text-sub); margin-bottom: 8px; }
        .bet-bottom { display: flex; justify-content: space-between; font-size: 12px; }
        
        .money-win { color: var(--accent-green); font-weight: 800; }
        .money-lose { color: var(--accent-red); font-weight: 800; }

        /* =========================================
           6. –ò–ì–†–´ (MINES & DICE)
           ========================================= */
        .game-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        input[type="number"], input[type="range"] {
            width: 100%;
            background: #090b0e;
            border: 1px solid var(--border);
            padding: 14px;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
            outline: none;
        }

        .btn-action {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: var(--accent);
            color: white;
            font-weight: 800;
            font-size: 16px;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-action.cashout { background: #e3b341; color: black; }

        /* Mines Grid */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .mine-cell {
            aspect-ratio: 1;
            background: #21262d;
            border-radius: 8px;
            border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer;
        }
        .mine-cell.gem { background: rgba(40, 167, 69, 0.2); border-color: var(--accent-green); }
        .mine-cell.boom { background: rgba(220, 53, 69, 0.2); border-color: var(--accent-red); }

        /* Dice 3D */
        .dice-container {
            height: 200px;
            display: flex; align-items: center; justify-content: center;
            perspective: 800px;
        }
        .cube {
            width: 80px; height: 80px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1.5s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        .face {
            position: absolute;
            width: 80px; height: 80px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            border: 2px solid white;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; font-weight: bold; color: white;
        }
        .f1 { transform: translateZ(40px); }
        .f6 { transform: rotateY(180deg) translateZ(40px); }
        .f2 { transform: rotateY(90deg) translateZ(40px); }
        .f5 { transform: rotateY(-90deg) translateZ(40px); }
        .f3 { transform: rotateX(90deg) translateZ(40px); }
        .f4 { transform: rotateX(-90deg) translateZ(40px); }

        /* =========================================
           7. –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (NAVBAR)
           ========================================= */
        nav {
            position: fixed; bottom: 0; width: 100%;
            height: 80px;
            background: var(--bg-header);
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around;
            padding: 10px 0 25px 0;
            z-index: 1000;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            gap: 4px;
            color: var(--text-sub);
            font-size: 10px;
            width: 20%;
            cursor: pointer;
            transition: 0.2s;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 22px; }

        /* =========================================
           8. –ê–î–ú–ò–ù–ö–ê –ò –£–¢–ò–õ–ò–¢–´
           ========================================= */
        .admin-box {
            display: none;
            margin-top: 30px;
            padding: 20px;
            border: 1px solid var(--accent-red);
            border-radius: 16px;
            background: rgba(220, 53, 69, 0.05);
        }
    </style>
</head>
<body>

    <!-- –®–ê–ü–ö–ê -->
    <header>
        <div class="logo">ROYAL<span>BET</span></div>
        <div class="balance-box">
            <span style="color:var(--accent)">‚ÇΩ</span>
            <span id="ui-balance">...</span>
        </div>
    </header>

    <main>
        <!-- 1. –°–¢–†–ê–ù–ò–¶–ê –°–ü–û–†–¢–ê -->
        <section id="p-sport" class="page active">
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="sport-cats">
                <div class="cat-chip active" onclick="Sport.filter('football', this)">‚öΩ –§—É—Ç–±–æ–ª</div>
                <div class="cat-chip" onclick="Sport.filter('hockey', this)">üèí –•–æ–∫–∫–µ–π</div>
                <div class="cat-chip" onclick="Sport.filter('tennis', this)">üéæ –¢–µ–Ω–Ω–∏—Å</div>
                <div class="cat-chip" onclick="Sport.filter('table_tennis', this)">üèì –ù–∞—Å—Ç–æ–ª—å–Ω—ã–π</div>
                <div class="cat-chip" onclick="Sport.filter('basketball', this)">üèÄ –ë–∞—Å–∫–µ—Ç</div>
            </div>

            <!-- –õ–µ–Ω—Ç–∞ –º–∞—Ç—á–µ–π -->
            <div id="sport-feed">
                <div style="text-align:center; margin-top:50px; color:var(--text-sub);">
                    <i class="fas fa-spinner fa-spin fa-2x"></i><br><br>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—á–µ–π...
                </div>
            </div>
        </section>

        <!-- 2. –°–¢–†–ê–ù–ò–¶–ê "–ú–û–ò –ü–ê–†–ò" -->
        <section id="p-bets" class="page">
            <h2 style="margin-top:0">–ú–æ–∏ –ø–∞—Ä–∏</h2>
            
            <div class="history-tabs">
                <div class="h-tab active" onclick="Bets.show('active', this)">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                <div class="h-tab" onclick="Bets.show('history', this)">–ò—Å—Ç–æ—Ä–∏—è</div>
            </div>

            <div id="bets-container">
                <!-- –°—é–¥–∞ –ø–æ–ø–∞–¥—É—Ç —Å—Ç–∞–≤–∫–∏ -->
            </div>
        </section>

        <!-- 3. MINES -->
        <section id="p-mines" class="page">
            <h2 style="margin-top:0">Mines</h2>
            <div class="game-panel">
                <input type="number" id="m-bet" value="100" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏">
                <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--text-sub); margin-bottom:10px;">
                    <span>–ú–∏–Ω—ã: <b id="m-cnt-val" style="color:white">3</b></span>
                    <span>–ö—ç—Ñ: <b id="m-coef" style="color:var(--accent)">x1.00</b></span>
                </div>
                <input type="range" id="m-cnt" min="3" max="24" value="3" oninput="Mines.updateInputs()">
                
                <button id="m-btn-start" class="btn-action" onclick="Mines.start()">–ò–ì–†–ê–¢–¨</button>
                <button id="m-btn-cash" class="btn-action cashout" style="display:none;" onclick="Mines.cashout()">–ó–ê–ë–†–ê–¢–¨</button>
            </div>
            <div class="mines-grid" id="m-grid"></div>
        </section>

        <!-- 4. DICE -->
        <section id="p-dice" class="page">
            <h2 style="margin-top:0">Dice 3D</h2>
            
            <div class="dice-container">
                <div class="cube" id="d-cube">
                    <div class="face f1">1</div><div class="face f2">6</div>
                    <div class="face f3">2</div><div class="face f4">5</div>
                    <div class="face f5">3</div><div class="face f6">4</div>
                </div>
            </div>

            <div class="game-panel">
                <input type="number" id="d-bet" value="100" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                    <div class="coeff-btn" id="d-even" onclick="Dice.setType('even')">
                        <span class="coeff-label">–ß–ï–¢–ù–û–ï</span>
                        <span class="coeff-val">x1.90</span>
                    </div>
                    <div class="coeff-btn" id="d-odd" onclick="Dice.setType('odd')">
                        <span class="coeff-label">–ù–ï–ß–ï–¢–ù–û–ï</span>
                        <span class="coeff-val">x1.90</span>
                    </div>
                </div>
                <button class="btn-action" style="background:var(--accent-blue)" onclick="Dice.roll()">–ë–†–û–°–û–ö</button>
            </div>
        </section>

        <!-- 5. –ü–†–û–§–ò–õ–¨ -->
        <section id="p-profile" class="page">
            <h2 style="margin-top:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            
            <div class="game-panel" style="text-align:center;">
                <div style="width:80px; height:80px; background:#21262d; border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:32px; border:2px solid var(--accent);">üòé</div>
                <h3>ID: <span id="prof-id">...</span></h3>
                <div style="font-size:12px; color:var(--text-sub); margin-top:5px; opacity:0.5;" onclick="App.triggerAdmin()">
                    Version 3.0 (Tap 5 times for Admin)
                </div>
            </div>

            <!-- –†–µ—Ñ–µ—Ä–∞–ª–∫–∞ -->
            <div style="background:linear-gradient(135deg, #1c2530, #111); border:1px solid #e3b341; border-radius:16px; padding:15px; margin-top:20px;">
                <h3 style="color:#e3b341; margin:0 0 10px 0;">ü§ù –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                <p style="font-size:12px; color:var(--text-sub);">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∞–π <b>10%</b> –æ—Ç –µ–≥–æ –ø—Ä–æ–∏–≥—Ä—ã—à–∞!</p>
                <div style="display:flex; justify-content:space-around; margin:15px 0;">
                    <div><span style="font-size:11px;color:var(--text-sub)">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</span><br><b style="font-size:16px" id="ui-ref-cnt">0</b></div>
                    <div><span style="font-size:11px;color:var(--text-sub)">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</span><br><b style="font-size:16px;color:var(--accent-green)" id="ui-ref-earn">0 ‚ÇΩ</b></div>
                </div>
                <button class="btn-action" style="background:#333; font-size:12px; padding:10px;" onclick="App.shareRef()">üîó –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</button>
            </div>

            <!-- –ê–¥–º–∏–Ω–∫–∞ (–°–∫—Ä—ã—Ç–∞—è) -->
            <div id="admin-panel" class="admin-box">
                <h4 style="color:var(--accent-red); margin-top:0;">ADMIN CONTROL</h4>
                <input type="number" id="adm-sum" placeholder="–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å">
                <button class="btn-action" onclick="App.setAdminBalance()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            </div>
        </section>

    </main>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <nav>
        <div class="nav-item active" onclick="Nav.go('sport', this)"><i class="fas fa-trophy"></i>–°–ø–æ—Ä—Ç</div>
        <div class="nav-item" onclick="Nav.go('bets', this)"><i class="fas fa-ticket-alt"></i>–ü–∞—Ä–∏</div>
        <div class="nav-item" onclick="Nav.go('mines', this)"><i class="fas fa-bomb"></i>Mines</div>
        <div class="nav-item" onclick="Nav.go('dice', this)"><i class="fas fa-dice"></i>Dice</div>
        <div class="nav-item" onclick="Nav.go('profile', this)"><i class="fas fa-user"></i>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </nav>

    <script>
        // ===========================================
        // ‚öôÔ∏è –°–ò–°–¢–ï–ú–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
        // ===========================================
        const tg = window.Telegram.WebApp;
        tg.expand();

        // !!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–®–£ –°–°–´–õ–ö–£ –° RENDER !!!
        const API_URL = "https://backend-4jag.onrender.com";

        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        const State = {
            user: { id: 0, balance: 0, history: [], activeBets: [] },
            matches: [],
            currentSport: 'football',
            currentBetTab: 'active'
        };

        // ===========================================
        // üöÄ –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–†–û–õ–õ–ï–†
        // ===========================================
        const App = {
            adminTaps: 0,

            init: async function() {
                // 1. –ü–æ–ª—É—á–∞–µ–º ID
                const user = tg.initDataUnsafe?.user;
                State.user.id = user ? user.id : 12345; // 12345 –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                document.getElementById('prof-id').innerText = State.user.id;

                // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª–∫—É
                const startParam = tg.initDataUnsafe?.start_param;

                // 3. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
                await this.fetchData(startParam);

                // 4. –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫)
                setInterval(() => this.fetchData(), 3000);

                // 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä
                Mines.init();
            },

            fetchData: async function(refId) {
                try {
                    // –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    let url = `${API_URL}/api/user/${State.user.id}`;
                    if(refId) url += `?ref_id=${refId}`;
                    
                    let res = await fetch(url);
                    let data = await res.json();

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    State.user.balance = data.balance;
                    State.user.history = data.history;
                    State.user.activeBets = data.active_bets;

                    // –û–±–Ω–æ–≤–ª—è–µ–º UI –ü—Ä–æ—Ñ–∏–ª—è
                    document.getElementById('ui-balance').innerText = Math.floor(data.balance).toLocaleString();
                    document.getElementById('ui-ref-cnt').innerText = data.ref_count;
                    document.getElementById('ui-ref-earn').innerText = Math.floor(data.ref_earn).toLocaleString() + ' ‚ÇΩ';

                    // –ó–∞–ø—Ä–æ—Å –º–∞—Ç—á–µ–π
                    let mRes = await fetch(`${API_URL}/api/matches`);
                    State.matches = await mRes.json();

                    // –†–µ–Ω–¥–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    if(document.getElementById('p-sport').classList.contains('active')) Sport.render();
                    if(document.getElementById('p-bets').classList.contains('active')) Bets.render();

                } catch(e) {
                    console.error("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:", e);
                }
            },

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞–≤–∫–∏
            placeBet: async function(endpoint, payload) {
                if(payload.amount > State.user.balance) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
                
                // –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ (—á—Ç–æ–±—ã –±—ã–ª–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
                State.user.balance -= payload.amount;
                document.getElementById('ui-balance').innerText = Math.floor(State.user.balance).toLocaleString();

                try {
                    let res = await fetch(`${API_URL}/api/${endpoint}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ user_id: State.user.id, ...payload })
                    });
                    let data = await res.json();
                    
                    if(data.status === 'ok') {
                        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
                        State.user.balance = data.new_balance;
                        if(endpoint === 'bet/sport') alert("–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!");
                    } else {
                        alert("–û—à–∏–±–∫–∞: " + data.msg);
                    }
                } catch(e) {
                    alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
                }
            },

            // –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
            triggerAdmin: function() {
                this.adminTaps++;
                if(this.adminTaps === 5) document.getElementById('admin-panel').style.display = 'block';
            },
            setAdminBalance: async function() {
                let val = document.getElementById('adm-sum').value;
                await fetch(`${API_URL}/api/admin/set`, {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body: JSON.stringify({ user_id: State.user.id, amount: val })
                });
                alert('–ë–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–µ–Ω');
            },
            shareRef: function() {
                tg.openTelegramLink(`https://t.me/share/url?url=https://t.me/YOUR_BOT?start=${State.user.id}&text=–ó–∞–±–∏—Ä–∞–π+–±–æ–Ω—É—Å!`);
            }
        };

        // ===========================================
        // ‚öΩ –°–ü–û–†–¢
        // ===========================================
        const Sport = {
            filter: function(category, el) {
                State.currentSport = category;
                document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
                el.classList.add('active');
                this.render();
            },

            render: function() {
                const container = document.getElementById('sport-feed');
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ Live, –ø–æ—Ç–æ–º –±–ª–∏–∂–∞–π—à–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
                const list = State.matches
                    .filter(m => m.sport === State.currentSport)
                    .sort((a, b) => {
                        if (a.isLive !== b.isLive) return a.isLive ? -1 : 1;
                        return a.timestamp - b.timestamp;
                    });

                if(list.length === 0) {
                    container.innerHTML = '<div style="text-align:center;padding:20px;color:#555">–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                    return;
                }

                container.innerHTML = list.map(m => {
                    // –í—Ä–µ–º—è
                    let timeBadge = '';
                    if(m.isLive) {
                        let displayTime = (m.sport.includes('tennis')) ? `–°–µ—Ç ${m.sets.length}` : `${Math.floor(m.time)}' –º–∏–Ω`;
                        timeBadge = `<div class="live-tag"><div class="live-dot"></div> ${displayTime}</div>`;
                    } else {
                        let d = new Date(m.timestamp);
                        let tStr = d.getHours().toString().padStart(2,'0') + ':' + d.getMinutes().toString().padStart(2,'0');
                        timeBadge = `<div style="color:var(--text-main); font-weight:bold"><i class="far fa-clock"></i> ${tStr}</div>`;
                    }

                    // –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ (–¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ç–µ–Ω–Ω–∏—Å–∞ / –§–æ—Ä–º—ã –¥–ª—è —Ñ—É—Ç–±–æ–ª–∞)
                    let contentHTML = '';

                    if(m.sport === 'tennis' || m.sport === 'table_tennis') {
                        // –¢–ê–ë–õ–ò–ß–ù–´–ô –í–ò–î (–ö–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ 1)
                        let setsHTML = '';
                        if(m.sets) {
                            for(let i=0; i<5; i++) {
                                let s = m.sets[i];
                                let isCurr = (i === m.sets.length - 1);
                                setsHTML += `<td class="${isCurr ? 'tt-set-active' : 'tt-set-score'}">${s ? s[0]+'<br>'+s[1] : '-<br>-'}</td>`;
                            }
                        }
                        contentHTML = `
                        <table class="table-tennis-grid">
                            <tr>
                                <td class="tt-name">${m.t1}<br>${m.t2}</td>
                                <td><div class="tt-main-score">${m.s1}<br>${m.s2}</div></td>
                                ${setsHTML}
                            </tr>
                        </table>`;
                    } else {
                        // –û–ë–´–ß–ù–´–ô –í–ò–î (–ö–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–∞—Ö 2,3,4)
                        contentHTML = `
                        <div class="teams-classic">
                            <div class="team-col">
                                <div class="team-shirt" style="background:${m.c1 || '#333'}">${m.t1[0]}</div>
                                <div class="team-name">${m.t1}</div>
                            </div>
                            <div class="score-big">${m.s1} : ${m.s2}</div>
                            <div class="team-col">
                                <div class="team-shirt" style="background:${m.c2 || '#555'}">${m.t2[0]}</div>
                                <div class="team-name">${m.t2}</div>
                            </div>
                        </div>`;
                    }

                    return `
                    <div class="match-card">
                        <div class="match-header">
                            ${timeBadge}
                            <span>${m.sport.toUpperCase()}</span>
                        </div>
                        
                        ${contentHTML}

                        <div class="coeffs-row">
                            <div class="coeff-btn" onclick="Sport.bet(${m.id}, '1', ${m.k1})">
                                <span class="coeff-label">–ü1</span><span class="coeff-val">${m.k1}</span>
                            </div>
                            <div class="coeff-btn" onclick="Sport.bet(${m.id}, 'x', ${m.kx})">
                                <span class="coeff-label">X</span><span class="coeff-val">${m.kx}</span>
                            </div>
                            <div class="coeff-btn" onclick="Sport.bet(${m.id}, '2', ${m.k2})">
                                <span class="coeff-label">–ü2</span><span class="coeff-val">${m.k2}</span>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            },

            bet: function(matchId, choice, coeff) {
                let amount = prompt(`–°—Ç–∞–≤–∫–∞ –Ω–∞ ${choice} (–ö—ç—Ñ ${coeff})\n–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É:`, 100);
                if(amount) {
                    App.placeBet('bet/sport', {
                        match_id: matchId,
                        choice: choice,
                        amount: parseFloat(amount),
                        coeff: coeff
                    });
                }
            }
        };

        // ===========================================
        // üßæ –ú–û–ò –ü–ê–†–ò
        // ===========================================
        const Bets = {
            show: function(tab, el) {
                State.currentBetTab = tab;
                document.querySelectorAll('.h-tab').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
                this.render();
            },

            render: function() {
                const container = document.getElementById('bets-container');
                let list = [];

                if(State.currentBetTab === 'active') {
                    // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –≤ –∫—Ä–∞—Å–∏–≤—ã–π –≤–∏–¥
                    list = State.user.activeBets.map(b => ({
                        game: b.game,
                        info: `–í—ã–±–æ—Ä: ${b.choice} ‚Ä¢ –ö—ç—Ñ: x${b.coeff}`,
                        left: `–°—Ç–∞–≤–∫–∞: ${b.bet} ‚ÇΩ`,
                        right: `–í—ã–∏–≥—Ä—ã—à: ${Math.floor(b.bet * b.coeff)} ‚ÇΩ`,
                        statusClass: 'active',
                        statusText: '–í –ò–ì–†–ï',
                        isWin: false
                    }));
                } else {
                    // –ò—Å—Ç–æ—Ä–∏—è
                    list = State.user.history.map(h => {
                        let isWin = h.win > 0;
                        let profit = Math.floor(h.win - h.bet);
                        return {
                            game: h.game,
                            info: `${h.details || '–ò–≥—Ä–∞'} ‚Ä¢ –ö—ç—Ñ: x${h.coeff}`,
                            left: `–°—Ç–∞–≤–∫–∞: ${h.bet} ‚ÇΩ`,
                            right: isWin ? `+${profit} ‚ÇΩ` : `-${h.bet} ‚ÇΩ`,
                            statusClass: isWin ? 'win' : 'lose',
                            statusText: isWin ? '–ü–û–ë–ï–î–ê' : '–ü–†–û–ò–ì–†–´–®',
                            isWin: isWin
                        };
                    });
                }

                if(list.length === 0) {
                    container.innerHTML = '<div style="text-align:center; padding:30px; color:#555">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>';
                    return;
                }

                container.innerHTML = list.map(item => `
                    <div class="bet-item ${item.statusClass}">
                        <div class="bet-top">
                            <span>${item.game}</span>
                            <span style="font-size:10px; opacity:0.7">${item.statusText}</span>
                        </div>
                        <div class="bet-details">${item.info}</div>
                        <div class="bet-bottom">
                            <span>${item.left}</span>
                            <span class="${item.statusClass === 'win' ? 'money-win' : (item.statusClass === 'lose' ? 'money-lose' : '')}">${item.right}</span>
                        </div>
                    </div>
                `).join('');
            }
        };

        // ===========================================
        // üí£ MINES
        // ===========================================
        const Mines = {
            act: false, grid: [], bet: 0, mult: 1, mines: 3,
            
            init: function() {
                const g = document.getElementById('m-grid'); g.innerHTML = '';
                for(let i=0; i<25; i++) {
                    let d = document.createElement('div');
                    d.className = 'mine-cell';
                    d.onclick = () => this.click(i, d);
                    g.appendChild(d);
                }
            },
            
            updateInputs: function() {
                this.mines = parseInt(document.getElementById('m-cnt').value);
                document.getElementById('m-cnt-val').innerText = this.mines;
            },

            start: function() {
                let bet = parseFloat(document.getElementById('m-bet').value);
                if(bet > State.user.balance) return alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");

                // –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
                this.bet = bet; this.act = true; this.mult = 1;
                this.grid = Array(25).fill(0);
                
                // –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞ (—Å–µ—Ä–≤–µ—Ä –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
                let c=0; while(c<this.mines){let r=Math.floor(Math.random()*25); if(!this.grid[r]){this.grid[r]=1; c++}}

                // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
                App.placeBet('bet/instant', {game:'Mines Start', bet:bet, win:0, coeff:0});

                // UI
                document.getElementById('m-btn-start').style.display='none';
                document.getElementById('m-btn-cash').style.display='block';
                document.getElementById('m-btn-cash').innerText = "–ó–ê–ë–†–ê–¢–¨";
                document.querySelectorAll('.mine-cell').forEach(c => {c.className='mine-cell'; c.innerText=''});
            },

            click: function(i, el) {
                if(!this.act || el.classList.contains('revealed')) return;
                el.classList.add('revealed');

                if(this.grid[i] === 1) {
                    // BOMB
                    el.classList.add('boom'); el.innerText = 'üí£';
                    this.finish(0); // –ü—Ä–æ–∏–≥—Ä—ã—à
                } else {
                    // GEM
                    el.classList.add('gem'); el.innerText = 'üíé';
                    // –§–æ—Ä–º—É–ª–∞ –∫—ç—Ñ–∞
                    let possible = 25 - this.mines;
                    let opened = document.querySelectorAll('.gem').length;
                    // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –¥–µ–º–æ
                    this.mult *= (1 + (this.mines / (possible - opened + 1))); 
                    
                    let win = Math.floor(this.bet * this.mult);
                    document.getElementById('m-btn-cash').innerText = `–ó–ê–ë–†–ê–¢–¨ ${win} ‚ÇΩ`;
                    document.getElementById('m-coef').innerText = "x" + this.mult.toFixed(2);
                }
            },

            cashout: function() {
                let win = Math.floor(this.bet * this.mult);
                this.finish(win);
            },

            finish: function(winAmount) {
                this.act = false;
                document.getElementById('m-btn-start').style.display='block';
                document.getElementById('m-btn-cash').style.display='none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–º–±—ã
                this.grid.forEach((v,k)=>{ if(v===1) {
                    let cell = document.getElementById('m-grid').children[k];
                    cell.classList.add('revealed', 'boom'); cell.innerText='üí£';
                }});

                if(winAmount > 0) {
                    let k = (winAmount / this.bet).toFixed(2);
                    App.placeBet('bet/instant', {game:'Mines Win', bet:0, win:winAmount, coeff:k});
                }
            }
        };

        // ===========================================
        // üé≤ DICE
        // ===========================================
        const Dice = {
            type: null,
            setType: function(t) {
                this.type = t;
                document.getElementById('d-even').style.border = t==='even' ? '1px solid #2ea043' : '1px solid #30363d';
                document.getElementById('d-odd').style.border = t==='odd' ? '1px solid #2ea043' : '1px solid #30363d';
            },
            roll: function() {
                let bet = parseFloat(document.getElementById('d-bet').value);
                if(!this.type) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –ß–µ—Ç/–ù–µ—á–µ—Ç");
                if(bet > State.user.balance) return alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");

                // –ê–Ω–∏–º–∞—Ü–∏—è
                let r = Math.floor(Math.random()*6)+1;
                let x=0, y=0;
                if(r===1){x=0;y=0} if(r===6){x=180;y=0} if(r===2){x=-90;y=0} 
                if(r===5){x=90;y=0} if(r===3){x=0;y=90} if(r===4){x=0;y=-90}
                document.getElementById('d-cube').style.transform = `rotateX(${x+720}deg) rotateY(${y+720}deg)`;

                setTimeout(() => {
                    let isWin = (this.type==='even' && r%2===0) || (this.type==='odd' && r%2!==0);
                    let winAmt = isWin ? Math.floor(bet * 1.9) : 0;
                    
                    App.placeBet('bet/instant', {game:'Dice', bet:bet, win:winAmt, coeff:1.9});
                    
                    if(isWin) alert(`–í—ã–ø–∞–ª–æ ${r}. –ü–æ–±–µ–¥–∞!`);
                    else alert(`–í—ã–ø–∞–ª–æ ${r}. –ü—Ä–æ–∏–≥—Ä—ã—à.`);
                }, 1600);
            }
        };

        // ===========================================
        // üß≠ –ù–ê–í–ò–ì–ê–¶–ò–Ø
        // ===========================================
        const Nav = {
            go: function(pageId, el) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('p-' + pageId).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');

                if(pageId === 'bets') Bets.render();
            }
        };

        // –ó–ê–ü–£–°–ö
        window.onload = () => App.init();

    </script>
</body>
</html>