<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Bet üéÆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-primary: #0e1015; --bg-secondary: #15181f; --bg-tertiary: #1c1f2a;
            --accent-green: #00ff88; --accent-blue: #00a8ff; --accent-red: #ff4757;
            --text-primary: #ffffff; --text-secondary: #8c94a3;
        }
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); padding-bottom: 80px; overflow-x: hidden; }
        .container { padding: 16px; max-width: 600px; margin: 0 auto; }
        .hidden { display: none !important; }
        
        /* Access Denied Screen */
        #accessDenied { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg-primary); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid #2a2f3d; }
        .balance { background: var(--bg-tertiary); padding: 8px 16px; border-radius: 20px; color: var(--accent-green); font-weight: bold; border: 1px solid #2a2f3d; }
        
        .card { background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 1px solid #2a2f3d; }
        .btn { width: 100%; padding: 14px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 8px; font-size: 16px; transition: transform 0.1s; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--accent-green); color: #000; }
        .btn-secondary { background: var(--bg-tertiary); color: #fff; border: 1px solid #2a2f3d; }
        .btn-danger { background: var(--accent-red); color: #fff; }
        
        /* Mines */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 20px 0; }
        .mine-cell { aspect-ratio: 1; background: var(--bg-tertiary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .mine-cell:active { transform: scale(0.9); }
        .mine-cell.revealed { background: #2d3446; }
        .mine-cell.safe { background: rgba(0, 255, 136, 0.2); border-color: var(--accent-green); }
        .mine-cell.boom { background: rgba(255, 71, 87, 0.2); border-color: var(--accent-red); }
        
        /* Crash */
        .crash-canvas { width: 100%; height: 250px; background: var(--bg-tertiary); border-radius: 12px; margin-bottom: 15px; position: relative; overflow: hidden; }
        #crashCanvas { width: 100%; height: 100%; }
        .crash-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; font-weight: bold; color: var(--accent-green); text-shadow: 0 0 10px rgba(0,255,136,0.3); }
        .crash-crashed { color: var(--accent-red); text-shadow: 0 0 10px rgba(255,71,87,0.3); }

        /* Nav */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(21,24,31,0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #2a2f3d; z-index: 100; }
        .nav-item { color: var(--text-secondary); text-decoration: none; font-size: 11px; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--accent-green); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        
        /* Modal */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: var(--bg-secondary); width: 90%; max-width: 400px; padding: 20px; border-radius: 16px; border: 1px solid #2a2f3d; }
        
        .row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        input[type="number"] { background: var(--bg-primary); border: 1px solid #2a2f3d; color: #fff; padding: 8px; border-radius: 6px; width: 80px; text-align: center; }
        
        .notif { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #333; padding: 10px 20px; border-radius: 20px; z-index: 3000; border: 1px solid #444; box-shadow: 0 4px 10px rgba(0,0,0,0.5); animation: slideDown 0.3s; display: flex; align-items: center; gap: 8px; }
        .notif.error { border-color: var(--accent-red); color: var(--accent-red); }
        .notif.success { border-color: var(--accent-green); color: var(--accent-green); }
        @keyframes slideDown { from { transform: translate(-50%, -100%); } to { transform: translate(-50%, 0); } }
    </style>
</head>
<body>

<!-- Access Denied Screen -->
<div id="accessDenied">
    <i class="fas fa-lock" style="font-size: 48px; color: var(--accent-red); margin-bottom: 20px;"></i>
    <h2>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
    <p style="color: #888;">–ó–∞–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞</p>
</div>

<div id="app" class="hidden">
    <div id="notifContainer"></div>

    <div class="container">
        <div class="header">
            <div style="font-weight: 800; font-size: 22px;">Royal Bet <span style="color:var(--accent-green)">.</span></div>
            <div class="balance" id="userBalance">0.00 ‚ÇΩ</div>
        </div>

        <!-- SPORTS -->
        <div id="sportsTab" class="tab-content">
            <h2 style="margin-top: 0;">–ú–∞—Ç—á–∏</h2>
            <div id="matchesContainer">Loading...</div>
        </div>

        <!-- GAMES -->
        <div id="gamesTab" class="tab-content hidden">
            <!-- Game Selector -->
            <div id="gameSelector">
                <div class="card" onclick="openMines()">
                    <h3><i class="fas fa-bomb" style="color:var(--accent-red)"></i> Mines</h3>
                    <p style="font-size: 12px; color:#888">–ù–∞–π–¥–∏ –∞–ª–º–∞–∑—ã, –∏–∑–±–µ–≥–∞–π –º–∏–Ω</p>
                </div>
                <div class="card" onclick="openCrash()">
                    <h3><i class="fas fa-plane" style="color:var(--accent-blue)"></i> Crash</h3>
                    <p style="font-size: 12px; color:#888">–£—Å–ø–µ–π –∑–∞–±—Ä–∞—Ç—å –¥–æ –∫—Ä–∞—Ö–∞</p>
                </div>
            </div>

            <!-- Mines Game -->
            <div id="minesGame" class="hidden">
                <button class="btn btn-secondary" onclick="closeGame()" style="width:auto; padding: 8px 16px; margin-bottom: 10px;"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
                <div class="card">
                    <div class="row" style="align-items: center;">
                        <span>–°—Ç–∞–≤–∫–∞: <input type="number" id="minesAmount" value="100"> ‚ÇΩ</span>
                        <span>–ú–∏–Ω—ã: <select id="minesCount" style="padding: 8px; border-radius:6px; background:var(--bg-primary); color:#fff; border:1px solid #2a2f3d;"><option value="3">3</option><option value="5">5</option><option value="10">10</option></select></span>
                    </div>
                    <div class="mines-grid" id="minesGrid"></div>
                    <button class="btn btn-primary" id="minesBtn">–ò–≥—Ä–∞—Ç—å</button>
                </div>
            </div>

            <!-- Crash Game -->
            <div id="crashGame" class="hidden">
                <button class="btn btn-secondary" onclick="closeGame()" style="width:auto; padding: 8px 16px; margin-bottom: 10px;"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
                <div class="card">
                    <div class="crash-canvas">
                        <canvas id="crashCanvas"></canvas>
                        <div class="crash-overlay" id="crashMultiplier">1.00x</div>
                    </div>
                    <div class="row" style="margin-top: 15px;">
                        <input type="number" id="crashAmount" value="100" style="width: 100%;">
                    </div>
                    <button class="btn btn-primary" id="crashBtn">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
        </div>

        <!-- PROFILE -->
        <div id="profileTab" class="tab-content hidden">
            <div class="profile-header">
                <div class="profile-avatar"><i class="fas fa-user"></i></div>
                <h2 id="userName">User</h2>
                <p style="color:#888; font-size:12px;">ID: <span id="userId">...</span></p>
            </div>
            <h3>–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫</h3>
            <div id="historyContainer"></div>
        </div>
    </div>

    <!-- Nav -->
    <nav class="nav">
        <a href="#" class="nav-item active" onclick="switchTab('sports', this)"><i class="fas fa-futbol"></i>–°–ø–æ—Ä—Ç</a>
        <a href="#" class="nav-item" onclick="switchTab('games', this)"><i class="fas fa-gamepad"></i>–ò–≥—Ä—ã</a>
        <a href="#" class="nav-item" onclick="switchTab('profile', this)"><i class="fas fa-user"></i>–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>
</div>

<!-- Match Details Modal -->
<div id="detailModal" class="modal hidden">
    <div class="modal-content">
        <h3 id="modalTitle">Match</h3>
        <div id="modalBody"></div>
        <button class="btn btn-secondary" onclick="document.getElementById('detailModal').classList.add('hidden')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    const API_URL = 'https://backend-4jag.onrender.com'; // –í–ê–ñ–ù–û: –¢–≤–æ–π URL
    let currentUser = null;
    
    // --- Mines State ---
    let minesActive = false;
    let minesId = null;
    let minesField = []; // We get this, but only reveal visually on click
    let minesOpened = 0;

    // --- Crash State ---
    let crashActive = false;
    let crashId = null;
    let crashPoint = 0;
    let crashCurrent = 1.0;
    let crashAnim = null;

    // INIT
    window.onload = async () => {
        // Strict Check
        if(!window.Telegram || !window.Telegram.WebApp || !window.Telegram.WebApp.initData) {
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –Ω–µ –≤ –¢–ì -> —Å—Ç–æ–ø
            return; 
        }
        
        // Hide Access Denied, Show App
        document.getElementById('accessDenied').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        
        await login();
    };

    async function login() {
        const initData = window.Telegram.WebApp.initData;
        try {
            const res = await fetch(`${API_URL}/api/init`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ initData })
            });
            const data = await res.json();
            if(data.success) {
                currentUser = data.user;
                updateHeader();
                loadMatches();
                renderMinesGrid(true);
            } else {
                alert("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");
            }
        } catch(e) { console.error(e); }
    }

    function updateHeader() {
        if(currentUser) {
            document.getElementById('userBalance').textContent = currentUser.balance.toFixed(2) + ' ‚ÇΩ';
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userId').textContent = currentUser.id;
        }
    }

    function notify(msg, type='success') {
        const div = document.createElement('div');
        div.className = `notif ${type}`;
        div.innerHTML = `<i class="fas fa-${type==='error'?'exclamation-circle':'check-circle'}"></i> ${msg}`;
        document.getElementById('notifContainer').appendChild(div);
        setTimeout(() => div.remove(), 3000);
    }

    // --- TABS ---
    function switchTab(tab, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.getElementById(tab+'Tab').classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(tab === 'profile') loadHistory();
    }

    function closeGame() {
        document.getElementById('minesGame').classList.add('hidden');
        document.getElementById('crashGame').classList.add('hidden');
        document.getElementById('gameSelector').classList.remove('hidden');
    }

    // --- SPORTS ---
    async function loadMatches() {
        const res = await fetch(`${API_URL}/api/matches`);
        const data = await res.json();
        const c = document.getElementById('matchesContainer');
        c.innerHTML = '';
        data.matches.forEach(m => {
            const d = document.createElement('div');
            d.className = 'card';
            d.innerHTML = `
                <div style="font-size:12px; color:#888; margin-bottom:5px;">${m.sport.toUpperCase()} ‚Ä¢ ${m.start_time.slice(0,10)}</div>
                <div class="row" style="align-items:center; margin-bottom:15px;">
                    <span style="font-weight:bold">${m.team_home}</span>
                    <span style="background:var(--bg-tertiary); padding:4px 8px; border-radius:4px; font-weight:bold; color:var(--accent-green)">${m.score_home}:${m.score_away}</span>
                    <span style="font-weight:bold">${m.team_away}</span>
                </div>
                <div class="row" style="gap:5px;">
                    <button class="btn btn-secondary" style="margin:0" onclick="betMatch(${m.id}, 'home', ${m.odds_home})">1 (${m.odds_home})</button>
                    <button class="btn btn-secondary" style="margin:0" onclick="betMatch(${m.id}, 'draw', ${m.odds_draw})">X (${m.odds_draw||'-'})</button>
                    <button class="btn btn-secondary" style="margin:0" onclick="betMatch(${m.id}, 'away', ${m.odds_away})">2 (${m.odds_away})</button>
                </div>
                <button class="btn btn-secondary" style="margin-top:8px; font-size:12px; padding:8px;" onclick='openDetails(${JSON.stringify(m)})'>–î–µ—Ç–∞–ª–∏</button>
            `;
            c.appendChild(d);
        });
    }

    async function betMatch(mid, outcome, odds) {
        if(!confirm(`–°—Ç–∞–≤–∫–∞ 100‚ÇΩ –Ω–∞ –∫–æ—ç—Ñ ${odds}?`)) return;
        const res = await fetch(`${API_URL}/api/bet`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({user_id:currentUser.id, match_id:mid, amount:100, odds:odds, outcome:outcome})
        });
        const d = await res.json();
        if(d.success) {
            notify("–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!");
            currentUser.balance = d.new_balance;
            updateHeader();
        } else notify(d.message, 'error');
    }

    function openDetails(m) {
        const det = m.details;
        document.getElementById('modalTitle').textContent = `${m.team_home} vs ${m.team_away}`;
        document.getElementById('modalBody').innerHTML = `
            <div class="row"><span>–¢–æ—Ç–∞–ª > ${det.total_val}</span> <b>${det.total_over}</b></div>
            <div class="row"><span>–¢–æ—Ç–∞–ª < ${det.total_val}</span> <b>${det.total_under}</b></div>
            <div class="row"><span>–û–±–µ –∑–∞–±—å—é—Ç</span> <b>${det.both_score_yes}</b></div>
        `;
        document.getElementById('detailModal').classList.remove('hidden');
    }

    // --- MINES ---
    function openMines() {
        document.getElementById('gameSelector').classList.add('hidden');
        document.getElementById('minesGame').classList.remove('hidden');
        renderMinesGrid(true); // Clear grid
    }

    function renderMinesGrid(reset=false) {
        const grid = document.getElementById('minesGrid');
        grid.innerHTML = ''; // IMPORTANT: Clears field
        for(let i=0; i<25; i++) {
            const cell = document.createElement('div');
            cell.className = 'mine-cell';
            if(!reset) {
                // If checking history or result
            } else {
                cell.innerHTML = '';
            }
            cell.onclick = () => clickMine(i, cell);
            grid.appendChild(cell);
        }
    }

    const minesBtn = document.getElementById('minesBtn');
    minesBtn.onclick = async () => {
        if(!minesActive) {
            // Start
            const amt = document.getElementById('minesAmount').value;
            const cnt = document.getElementById('minesCount').value;
            
            const res = await fetch(`${API_URL}/api/game`, {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({user_id:currentUser.id, game_type:'mines', amount:amt, mines_count:cnt})
            });
            const d = await res.json();
            if(d.success) {
                minesActive = true;
                minesId = d.bet_id;
                minesField = d.field; // Store internally
                minesOpened = 0;
                currentUser.balance = d.new_balance;
                updateHeader();
                
                renderMinesGrid(true); // Clear visual
                minesBtn.textContent = "–ó–∞–±—Ä–∞—Ç—å (–í–æ–∑–≤—Ä–∞—Ç 80%)";
                minesBtn.className = "btn btn-secondary";
            } else notify(d.message, 'error');
        } else {
            // Cashout
            const res = await fetch(`${API_URL}/api/mines/cashout`, {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({user_id:currentUser.id, crash_id:minesId})
            });
            const d = await res.json();
            if(d.success) {
                endMines(true, d.win_amount);
            }
        }
    };

    async function clickMine(idx, cell) {
        if(!minesActive || cell.classList.contains('revealed')) return;
        
        // 1. Send update to server (Anti-cheat)
        fetch(`${API_URL}/api/mines/update`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({crash_id:minesId})
        });

        // 2. Visual Logic
        cell.classList.add('revealed');
        
        if(minesField[idx] === 1) {
            // Boom
            cell.classList.add('boom');
            cell.innerHTML = 'üí£';
            endMines(false);
        } else {
            // Safe
            cell.classList.add('safe');
            cell.innerHTML = 'üíé';
            minesOpened++;
            minesBtn.textContent = "–ó–∞–±—Ä–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à";
            minesBtn.className = "btn btn-primary";
        }
    }

    function endMines(win, amount=0) {
        minesActive = false;
        minesBtn.textContent = "–ò–≥—Ä–∞—Ç—å";
        minesBtn.className = "btn btn-primary";
        
        if(win) {
            currentUser.balance += amount; // Sync locally for speed
            // Actually balance comes from server response in real implementation
            // But here we rely on the cashout response
            updateHeader();
            
            if(minesOpened === 0) notify(`–í–æ–∑–≤—Ä–∞—Ç: ${amount.toFixed(2)}‚ÇΩ`);
            else notify(`–ü–æ–±–µ–¥–∞! +${amount.toFixed(2)}‚ÇΩ`);
        } else {
            notify("–í–∑—Ä—ã–≤!", 'error');
            // Show all mines
            const cells = document.querySelectorAll('.mine-cell');
            minesField.forEach((isMine, i) => {
                if(isMine) {
                    cells[i].classList.add('revealed', 'boom');
                    cells[i].innerHTML = 'üí£';
                }
            });
        }
        // Force refresh balance
        login(); 
    }

    // --- CRASH ---
    function openCrash() {
        document.getElementById('gameSelector').classList.add('hidden');
        document.getElementById('crashGame').classList.remove('hidden');
        initCrashCanvas();
    }

    function initCrashCanvas() {
        const c = document.getElementById('crashCanvas');
        c.width = c.offsetWidth;
        c.height = c.offsetHeight;
        const ctx = c.getContext('2d');
        ctx.fillStyle = "#1c1f2a";
        ctx.fillRect(0,0,c.width,c.height);
        
        // Draw grid
        ctx.strokeStyle = "#2a2f3d";
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<c.width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,c.height); }
        for(let i=0; i<c.height; i+=50) { ctx.moveTo(0,i); ctx.lineTo(c.width,i); }
        ctx.stroke();
    }

    const crashBtn = document.getElementById('crashBtn');
    crashBtn.onclick = async () => {
        if(!crashActive) {
            // Start
            const amt = document.getElementById('crashAmount').value;
            const res = await fetch(`${API_URL}/api/crash/start`, {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({user_id:currentUser.id, amount:amt})
            });
            const d = await res.json();
            if(d.success) {
                crashActive = true;
                crashId = d.game_id;
                crashPoint = d.crash_point;
                currentUser.balance = d.new_balance;
                updateHeader();
                
                crashBtn.textContent = "–ó–ê–ë–†–ê–¢–¨";
                crashBtn.className = "btn btn-secondary";
                
                startCrashAnim();
            } else notify(d.message, 'error');
        } else {
            // Cashout
            const res = await fetch(`${API_URL}/api/crash/cashout`, {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({user_id:currentUser.id, crash_id:crashId})
            });
            const d = await res.json();
            if(d.success) {
                crashActive = false; // Stop internal tracker
                // Animation loop handles the rest
                notify(`–í—ã–≤–µ–ª –Ω–∞ ${d.multiplier}x (+${d.win_amount}‚ÇΩ)`);
                currentUser.balance = d.new_balance;
                updateHeader();
            }
        }
    };

    function startCrashAnim() {
        const c = document.getElementById('crashCanvas');
        const ctx = c.getContext('2d');
        let startTime = Date.now();
        crashCurrent = 1.0;
        
        function loop() {
            if(!crashActive && crashCurrent >= crashPoint) return; // End handled elsewhere if lost
            
            let now = Date.now();
            let elapsed = (now - startTime) / 1000;
            crashCurrent = 1.0 + Math.pow(elapsed, 2) * 0.1; // Simple exponential curve
            
            // UI Update
            document.getElementById('crashMultiplier').textContent = crashCurrent.toFixed(2) + 'x';
            
            // Draw
            ctx.fillStyle = "#1c1f2a";
            ctx.fillRect(0,0,c.width,c.height);
            
            // Draw Curve
            ctx.beginPath();
            ctx.moveTo(0, c.height);
            // Draw quadratic curve based on time
            let x = (elapsed * 50) % c.width;
            let y = c.height - (Math.pow(elapsed, 2) * 20);
            if(y < 50) y = 50; // clamp top
            
            ctx.quadraticCurveTo(x/2, c.height, x, y);
            ctx.strokeStyle = "#00ff88";
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Plane Emoji
            ctx.font = "24px Arial";
            ctx.fillText("‚úàÔ∏è", x-10, y-10);
            
            // Check Crash
            if(crashCurrent >= crashPoint) {
                crashActive = false;
                crashBtn.textContent = "–°—Ç–∞—Ä—Ç";
                crashBtn.className = "btn btn-primary";
                document.getElementById('crashMultiplier').classList.add('crash-crashed');
                document.getElementById('crashMultiplier').textContent = "CRASHED @ " + crashPoint.toFixed(2) + "x";
                
                // Boom visual
                ctx.fillText("üí•", x-10, y-10);
                return; 
            }
            
            if(crashActive) requestAnimationFrame(loop);
            else {
                // If user cashed out
                crashBtn.textContent = "–°—Ç–∞—Ä—Ç";
                crashBtn.className = "btn btn-primary";
                document.getElementById('crashMultiplier').style.color = "#fff";
                document.getElementById('crashMultiplier').textContent = "WON!";
            }
        }
        document.getElementById('crashMultiplier').classList.remove('crash-crashed');
        document.getElementById('crashMultiplier').style.color = "#00ff88";
        loop();
    }

    async function loadHistory() {
        const res = await fetch(`${API_URL}/api/history?user_id=${currentUser.id}`);
        const d = await res.json();
        document.getElementById('historyContainer').innerHTML = d.history.map(h => `
            <div style="background:var(--bg-tertiary); padding:10px; margin-bottom:8px; border-radius:8px; border-left:4px solid ${h.status==='won'?'var(--accent-green)':'var(--accent-red)'}">
                <div class="row" style="margin:0">
                    <span>${h.game_type.toUpperCase()}</span>
                    <span>${h.amount}‚ÇΩ</span>
                </div>
                <div style="font-size:12px; color:#888; text-align:right">${h.status} | x${h.odds}</div>
            </div>
        `).join('');
    }
</script>
</body>
</html>
